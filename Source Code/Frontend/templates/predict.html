
{% extends "index.html" %}
{% block content %}

<style>
.risk-wrap {
  min-height: 100vh;
  background: radial-gradient(circle at top, #eef1ff, #f7f8fc);
  padding: 50px 15px;
  font-family: "Segoe UI", system-ui, sans-serif;
}

.risk-report {
  max-width: 900px;
  margin: auto;
  background: white;
  border-radius: 24px;
  box-shadow: 0 25px 60px rgba(70, 96, 228, 0.25);
}

.risk-header {
  background: linear-gradient(135deg, #4660e4, #6f85ff);
  color: white;
  padding: 30px;
  text-align: center;
}

.risk-body {
  padding: 35px;
}

.form-control {
  height: 36px;
  font-size: 14px;
  border-radius: 10px;
  border: 1px solid #d6dcff;
}

.error-text {
  color: red;
  font-size: 13px;
  margin-top: 4px;
}

.result-box {
  margin-top: 25px;
  padding: 20px;
  border-radius: 18px;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
}

.result-warning {
  background: #fff3cd;
  color: #856404;
  border: 2px solid #ffc107;
}

.result-positive {
  background: #fdecea;
  color: #dc3545;
  border: 2px solid #dc3545;
}

.result-negative {
  background: #edf2ff;
  color: #2536a3;
  border: 2px solid #4660e4;
}
</style>

<div class="risk-wrap">
<div class="risk-report">

<div class="risk-header">
  <h2>Heart Disease Prediction</h2>
  <p>Enter clinical values to predict heart disease</p>
</div>

<div class="risk-body">

<form method="post" action="{{ url_for('predict') }}" id="heartForm" novalidate>

<div class="row">

<!-- LEFT -->
<div class="col-md-6">

{% macro field(label,name,min,max,step='1') %}
<div class="form-group mb-3">
<label>{{label}}</label>
<input type="number"
       name="{{name}}"
       class="form-control"
       min="{{min}}"
       max="{{max}}"
       step="{{step}}"
       required>
<div class="error-text"></div>
</div>
{% endmacro %}

{{ field("Age","age",1,100) }}
{{ field("Sex (0-1)","sex",0,1) }}
{{ field("cp (0-3)","cp",0,3) }}
{{ field("trestbps","trestbps",80,200) }}
{{ field("chol","chol",100,600) }}
{{ field("fbs (0-1)","fbs",0,1) }}

</div>

<!-- RIGHT -->
<div class="col-md-6">

{{ field("restecg (0-2)","restecg",0,2) }}
{{ field("thalach","thalach",60,220) }}
{{ field("exang (0-1)","exang",0,1) }}
{{ field("oldpeak","oldpeak",0,10,"0.1") }}
{{ field("slope (0-2)","slope",0,2) }}
{{ field("ca (0-3)","ca",0,3) }}
{{ field("thal (1-3)","thal",1,3) }}

</div>
</div>

<div class="text-center mt-4">
<button class="btn btn-primary">Predict</button>
<button class="btn btn-secondary" type="reset">Reset</button>
</div>

</form>

<!-- RESULT DISPLAY -->
<div id="resultArea">
{% if result %}
  {% if "NO" in result.label or "No" in result.label %}
    <div class="result-box result-negative">
      ✅ {{ result.label }}
    </div>
  {% else %}
    <div class="result-box result-positive">
      ⚠️ {{ result.label }}
    </div>
  {% endif %}
{% endif %}
</div>

</div>
</div>
</div>
<script>

function validateField(input){
  const group = input.closest(".form-group");
  const errorDiv = group.querySelector(".error-text");

  errorDiv.textContent = "";

  if(input.value === ""){
    errorDiv.textContent = "This field is required";
    return false;
  }

  const value = parseFloat(input.value);
  const min = parseFloat(input.min);
  const max = parseFloat(input.max);

  if(value < min){
    errorDiv.textContent = `Minimum value is ${min}`;
    return false;
  }

  if(value > max){
    errorDiv.textContent = `Maximum value is ${max}`;
    return false;
  }

  return true;
}

document.querySelectorAll(".form-control").forEach(input => {

  // live validation while typing
  input.addEventListener("input", function(){
    validateField(this);
  });

});

document.getElementById("heartForm").addEventListener("submit", function(e){

  let valid = true;

  document.querySelectorAll(".form-control").forEach(input => {
    if(!validateField(input)){
      valid = false;
    }
  });

  if(!valid){
    e.preventDefault();
    document.getElementById("resultArea").innerHTML = `
      <div class="result-box result-warning">
        ⚠️ Please correct the highlighted fields
      </div>`;
  }

});

</script>


{% endblock %}
